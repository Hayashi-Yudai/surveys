# DeepBach:  Steerable Model for Bach Chorales Generation
Author : Ga¨etan Hadjeres, Franc¸ois Pachet, Frank Nielsen

ソニー・コンピュータ・サイエンス研究所所属（当時）

https://arxiv.org/abs/1612.01010  （原著論文）

https://youtu.be/QiBM7-5hA6o （生成作品の動画）

まとめ：細井博之

## どんなもの？
- ヨハン・セバスティアン・バッハの四声対位法様式の音楽作品を自動生成する
- 深層学習モデルの訓練には実際のバッハの作品を教師データとして使用する

＜バッハの作品例＞

<img src="https://user-images.githubusercontent.com/1649997/132941498-13e5eabe-bd6a-4fcb-9901-66b42baf6d90.png" width=70%>

＜各声部の音高と拍、フェルマータの有無の情報が対象＞

<img src="https://user-images.githubusercontent.com/1649997/132941601-429498ba-829d-470f-afbd-cb0332ecf154.png" width=70%>

## 先行研究と比べてどこがすごい？
- 最初から最後までシーケンシャルに生成する必要が無い
    - すでに生成された部分を後から変更可能
    - 計算が非常に高速（並列計算可能）なのでユーザーと対話しつつ生成できるなどの柔軟性を持つ
- C dur 以外の調で作曲できる
- 柔軟な拘束条件を指定できる
    - 先行研究では固定できる声部はソプラノに限定されていた
    - 今回の手法では声部以外にも**リズムのみ固定**や**ある小節のある拍の和音を固定**など柔軟な指定が可能

## 技術や手法の肝は？
<img src="https://user-images.githubusercontent.com/1649997/132942883-30dbe193-b96e-4397-bb7e-f26e34cd3e05.png" width=40% align=right>

### 確率で考える
- バッハ作品の中に出てくる4声の和音の音高の組み合わせを確率で考える
#### 条件付き確率の考え方を応用する
- 「4和音のうちの3つの音が既に決まっている」という条件の時、残りの1つの音がどの高さになるか、という確率を考える
#### ギプス・サンプリング
- ある確率分布が存在する時に、ある条件が与えられれば残りの確率分布が分かる、というケースの時に使用されるサンプリング手法
- 疑似ギプス・サンプリング
    - DeepBach では推論時（音楽の生成時）にギプス・サンプリングのような事を行いながら音を決めていく
### 深層学習モデルの問題設定
- ある1つ以外の音は全て決まっている、という条件付きの場合に、その1つの音が何になるかを推論する

- 4つのニューラルネットを組み合わせる
    - 中央：和音担当
    - 左側・右側：RNN で時間軸方向の連続性を担当
    - 下側：最終出力を担当

- 推論したい音のある一定の比較的短い前後区間の全パートの音を入力する
    - バッハのコラールは長い時間方向の依存関係は存在しないため、上手く行く

### 推論手順
<img src="https://user-images.githubusercontent.com/1649997/132943331-089467c5-9aaa-48d3-a3b9-f42ec4816680.png">

- 並列実行可能
    - バッチサイズ16 or 32 にしても、動作速度は10倍になりなおかつ十分に音楽的な結果が得られた
- 上手く行くのはデータの表現形式のおかげ
    - hold symbol（保続表現） _ が重要
### オーグメンテーション
- 先行研究では C dur に移調してしまっていた
- 今回の手法では音域内で移調してオーグメンテーションを施した
    - これにより 352 曲だったデータが 2503 曲になった
### その他
- 実運用段階では調性の情報を持たせ、異名同音表記にも対応した

### （以下私見）
- 確率分布をバッハの曲から真面目に集計しようとすると、そもそも確率が存在しないというパターンが続出する
- ニューラルネットの組み合わせで、実際には存在しないパターンの場合でもそこそこ妥当に推論できるようにした
- サンプリングを繰り返す方式なので、一度の推論で完璧な解答を得る必要が無いので都合が良い

## どうやって有効だと検証した？
- 実際に人間に聞いてもらって、音楽が自動作曲によるものかバッハ本人のものかを答えてもらって評価した
- 被験者にはあらかじめ自己回答で自分自身が以下3つのうちどれに当てはまるかを尋ねた（expertise）  
1. 普段クラシック音楽をほとんど聞かない（261人）
2. 音楽が好き、またはアマチュア音楽家（646人）
3. 作曲科の学生、またはプロ音楽家（365人）
            
＜被験者の熟練度による回答の分布＞

<img src="https://user-images.githubusercontent.com/1649997/133010855-60fe2d9c-4f22-4ef5-ac00-3724732edc64.png" width=80%>

＜曲ごとのバッハのものであると回答した人の割合＞

<img src="https://user-images.githubusercontent.com/1649997/133012137-6c29989c-0ed6-4a97-a52f-6e09140b2bf9.png" width=50%>

- 連続8度などの禁則は犯すものの、韻律の特徴から非和声音の効果的な使い方まで、おおむねバッハらしいパターンを再現できている

＜メタデータ（フェルマータの位置）が同じでも異なる曲を生成できた＞
![image](https://user-images.githubusercontent.com/1649997/133013054-733e7e07-1e19-42ba-b0c6-7f323743c0a4.png)


## 議論はある？
- 禁則を犯すことを除いては、対位法的な声部間の処理はなかなか良さそう
- 機能和声感（調性感）が希薄な部分はバッハらしく聞こえない
    - サンプリング元のバッハのコラールがそもそもそうなっている？
        - 完全なバッハ作品ではなく、ソプラノを昔の聖歌から引用してバッハが和声付けをした作品のため？  
- ユーザーと対話しながら作れるのはかなり良さそう
    -  ![image](https://user-images.githubusercontent.com/1649997/133016288-43e18ada-e4c0-4d7f-9d17-0abd8ad7f0da.png)
    -  他の分野でも対話したり何かを提案してくれる補助的なシステムは面白そう
        - 例）献立提案システムで、冷蔵庫にある食材を伝えると献立を提案してくれるなど 
    -  対話型なら、ユーザーが自発的・主体的になれそう

## 次に読むべきタイトルは？
- Music Composition with Deep Learning: A Review https://arxiv.org/abs/2108.12290
- A Comprehensive Survey on Deep Music Generation: Multi-level Representations, Algorithms, Evaluations, and Future Directions https://arxiv.org/abs/2011.06801
